<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor Universal de Arquivos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .converter-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        select, button {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            margin-bottom: 15px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        #fileInput {
            display: none;
        }
        .file-input-label {
            display: block;
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: background-color 0.3s;
        }
        .file-input-label:hover {
            background-color: #27ae60;
        }
        #fileInfo {
            margin: 15px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        #progress {
            margin: 20px 0;
            display: none;
            background-color: #e9ecef;
            border-radius: 5px;
            padding: 10px;
        }
        .progress-bar {
            height: 20px;
            background-color: #3498db;
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s;
        }
        #results {
            margin-top: 30px;
        }
        .result-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .download-btn {
            display: inline-block;
            padding: 8px 15px;
            background-color: #9b59b6;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        .download-btn:hover {
            background-color: #8e44ad;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .format-info {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Conversor Universal de Arquivos</h1>
    
    <div class="converter-container">
        <div class="input-group">
            <label for="fileInput">Selecione o arquivo para conversão:</label>
            <label for="fileInput" class="file-input-label">Escolher Arquivo</label>
            <input type="file" id="fileInput" />
            <div id="fileInfo">Nenhum arquivo selecionado</div>
        </div>
        
        <div class="input-group">
            <label for="outputFormat">Selecione o formato de saída:</label>
            <select id="outputFormat" disabled>
                <option value="">Selecione um arquivo primeiro</option>
                <!-- Opções serão preenchidas dinamicamente -->
            </select>
            <div class="format-info" id="formatInfo"></div>
        </div>
        
        <button id="convertBtn" disabled>Converter Arquivo</button>
        
        <div id="progress" style="display: none;">
            <div>Convertendo arquivo...</div>
            <div class="progress-bar" id="progressBar"></div>
            <div id="progressText">0%</div>
        </div>
    </div>
    
    <div id="status" class="status"></div>
    
    <div id="results"></div>

    <!-- Bibliotecas necessárias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ffmpeg.js/4.2.9003/ffmpeg.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // Configurações iniciais
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
        
        // Mapeamento de conversões suportadas
        const supportedConversions = {
            // Documentos
            'pdf': {
                name: 'PDF',
                conversions: {
                    'jpg': 'Imagem JPEG',
                    'png': 'Imagem PNG',
                    'txt': 'Texto simples',
                    'docx': 'Documento Word'
                }
            },
            'docx': {
                name: 'Documento Word',
                conversions: {
                    'pdf': 'PDF',
                    'txt': 'Texto simples',
                    'html': 'HTML',
                    'md': 'Markdown'
                }
            },
            'xlsx': {
                name: 'Planilha Excel',
                conversions: {
                    'csv': 'CSV',
                    'pdf': 'PDF',
                    'json': 'JSON'
                }
            },
            'jpg': {
                name: 'Imagem JPEG',
                conversions: {
                    'png': 'Imagem PNG',
                    'webp': 'Imagem WebP',
                    'pdf': 'PDF'
                }
            },
            'png': {
                name: 'Imagem PNG',
                conversions: {
                    'jpg': 'Imagem JPEG',
                    'webp': 'Imagem WebP',
                    'pdf': 'PDF'
                }
            },
            // Adicione mais tipos conforme necessário
        };
        
        // Elementos do DOM
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const outputFormat = document.getElementById('outputFormat');
        const formatInfo = document.getElementById('formatInfo');
        const convertBtn = document.getElementById('convertBtn');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        
        let selectedFile = null;
        let fileExtension = '';
        
        // Quando um arquivo é selecionado
        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length === 0) return;
            
            selectedFile = e.target.files[0];
            fileExtension = selectedFile.name.split('.').pop().toLowerCase();
            
            fileInfo.innerHTML = `
                <strong>Arquivo selecionado:</strong> ${selectedFile.name}<br>
                <strong>Tipo:</strong> ${selectedFile.type || 'Desconhecido'}<br>
                <strong>Tamanho:</strong> ${(selectedFile.size / 1024 / 1024).toFixed(2)} MB
            `;
            
            // Configura as opções de conversão
            setupConversionOptions(fileExtension);
            
            // Limpa resultados anteriores
            resultsDiv.innerHTML = '';
            statusDiv.style.display = 'none';
        });
        
        // Configura as opções de conversão com base na extensão do arquivo
        function setupConversionOptions(ext) {
            outputFormat.innerHTML = '<option value="">Selecione um formato...</option>';
            
            if (supportedConversions[ext]) {
                outputFormat.disabled = false;
                convertBtn.disabled = true;
                
                const conversions = supportedConversions[ext].conversions;
                for (const [format, description] of Object.entries(conversions)) {
                    const option = document.createElement('option');
                    option.value = format;
                    option.textContent = `${description} (.${format})`;
                    outputFormat.appendChild(option);
                }
                
                formatInfo.textContent = `Conversões disponíveis para ${supportedConversions[ext].name}`;
            } else {
                outputFormat.disabled = true;
                convertBtn.disabled = true;
                formatInfo.textContent = `Não há conversões disponíveis para arquivos .${ext}`;
            }
        }
        
        // Quando o formato de saída é selecionado
        outputFormat.addEventListener('change', function() {
            convertBtn.disabled = !this.value;
        });
        
        // Quando o botão de conversão é clicado
        convertBtn.addEventListener('click', async function() {
            if (!selectedFile || !outputFormat.value) return;
            
            try {
                // Prepara a interface
                progress.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                convertBtn.disabled = true;
                resultsDiv.innerHTML = '';
                statusDiv.style.display = 'none';
                
                // Executa a conversão
                const result = await convertFile(
                    selectedFile, 
                    fileExtension, 
                    outputFormat.value,
                    (progress) => {
                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `${progress}%`;
                    }
                );
                
                // Exibe o resultado
                showResult(result);
                
                // Mensagem de sucesso
                statusDiv.textContent = `Conversão concluída com sucesso para ${outputFormat.value.toUpperCase()}!`;
                statusDiv.className = 'status success';
                statusDiv.style.display = 'block';
                
            } catch (error) {
                console.error('Erro na conversão:', error);
                statusDiv.textContent = `Erro na conversão: ${error.message}`;
                statusDiv.className = 'status error';
                statusDiv.style.display = 'block';
            } finally {
                convertBtn.disabled = false;
                progress.style.display = 'none';
            }
        });
        
        // Função principal de conversão
        async function convertFile(file, fromExt, toExt, progressCallback) {
            progressCallback(10);
            
            return new Promise(async (resolve, reject) => {
                try {
                    const reader = new FileReader();
                    
                    reader.onload = async function(e) {
                        try {
                            const arrayBuffer = e.target.result;
                            let result;
                            
                            progressCallback(30);
                            
                            // PDF para outros formatos
                            if (fromExt === 'pdf' && ['jpg', 'png'].includes(toExt)) {
                                result = await convertPdfToImage(arrayBuffer, toExt);
                            } 
                            // Documentos Word para outros formatos
                            else if (fromExt === 'docx' && toExt === 'pdf') {
                                result = await convertDocxToPdf(arrayBuffer);
                            }
                            // Planilhas Excel para CSV
                            else if (fromExt === 'xlsx' && toExt === 'csv') {
                                result = await convertXlsxToCsv(arrayBuffer);
                            }
                            // Imagens para outros formatos
                            else if (['jpg', 'png'].includes(fromExt) && ['jpg', 'png', 'webp'].includes(toExt)) {
                                result = await convertImageFormat(file, toExt);
                            }
                            // Adicione mais conversões aqui
                            else {
                                throw new Error(`Conversão de ${fromExt} para ${toExt} não implementada`);
                            }
                            
                            progressCallback(90);
                            resolve(result);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = reject;
                    
                    if (['jpg', 'png', 'webp'].includes(fromExt)) {
                        reader.readAsDataURL(file);
                    } else {
                        reader.readAsArrayBuffer(file);
                    }
                    
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        // Funções específicas de conversão
        async function convertPdfToImage(pdfData, imageFormat) {
            const pdf = await pdfjsLib.getDocument({data: pdfData}).promise;
            const page = await pdf.getPage(1);
            const viewport = page.getViewport({ scale: 1.5 });
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            await page.render({
                canvasContext: context,
                viewport: viewport
            }).promise;
            
            return {
                data: canvas.toDataURL(`image/${imageFormat}`, 0.8),
                format: imageFormat,
                pages: pdf.numPages
            };
        }
        
     
        async function convertXlsxToCsv(xlsxData) {
            const workbook = XLSX.read(xlsxData, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const csv = XLSX.utils.sheet_to_csv(worksheet);
            
            return {
                data: 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv),
                format: 'csv'
            };
        }
        
        async function convertImageFormat(imageFile, targetFormat) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        
                        resolve({
                            data: canvas.toDataURL(`image/${targetFormat}`, 0.8),
                            format: targetFormat
                        });
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(imageFile);
            });
        }
        
        // Exibe o resultado da conversão
        function showResult(result) {
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            
            let content = '';
            
            if (result.format === 'jpg' || result.format === 'png' || result.format === 'webp') {
                content = `
                    <h3>Imagem convertida (${result.format.toUpperCase()})</h3>
                    <img src="${result.data}" style="max-width: 100%;" alt="Imagem convertida">
                    <a href="${result.data}" download="Ix1IDEA.${result.format}" class="download-btn">
                        Baixar Imagem
                    </a>
                `;
            } else if (result.format === 'pdf') {
                content = `
                    <h3>PDF gerado</h3>
                    <p>Documento convertido para PDF</p>
                    <a href="${result.data}" Ix1IDEA="i.pdf" class="download-btn">
                        Baixar PDF
                    </a>
                `;
            } else if (result.format === 'csv') {
                content = `
                    <h3>CSV gerado</h3>
                    <p>Planilha convertida para CSV</p>
                    <a href="${result.data}" download="Ix1IDEA.csv" class="download-btn">
                        Baixar CSV
                    </a>
                `;
            } else {
                content = `
                    <h3>Arquivo convertido (${result.format.toUpperCase()})</h3>
                    <a href="${result.data}" download="Ix1IDEA.${result.format}" class="download-btn">
                        Baixar Arquivo
                    </a>
                `;
            }
            
            resultItem.innerHTML = content;
            resultsDiv.appendChild(resultItem);
        }
    </script>
</body>
</html>